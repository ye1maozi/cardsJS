<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSVé…ç½®åŠ è½½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .card {
            display: inline-block;
            width: 150px;
            height: 100px;
            margin: 5px;
            padding: 10px;
            border: 2px solid #007bff;
            border-radius: 8px;
            background-color: #f8f9fa;
            cursor: pointer;
            text-align: center;
            font-size: 11px;
            vertical-align: top;
        }
        .card:hover {
            background-color: #e9ecef;
        }
        .card.disabled {
            border-color: #6c757d;
            background-color: #e9ecef;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .card.used {
            border-color: #28a745;
            background-color: #d4edda;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background-color: #e9ecef;
        }
        .health {
            color: #dc3545;
            font-weight: bold;
        }
        .armor {
            color: #17a2b8;
            font-weight: bold;
        }
        .energy {
            color: #ffc107;
            font-weight: bold;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
        }
        .config-info {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        .config-info h4 {
            margin: 0 0 10px 0;
            color: #007bff;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .warning {
            color: #ffc107;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>CSVé…ç½®åŠ è½½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>é…ç½®åŠ è½½çŠ¶æ€</h2>
            <div id="configStatus" class="status">
                <div>é…ç½®åŠ è½½çŠ¶æ€: <span id="loadStatus">æœªåŠ è½½</span></div>
                <div>åŠ è½½æ–¹å¼: <span id="loadMethod">-</span></div>
                <div>å¡ç‰Œæ•°é‡: <span id="cardCount">0</span></div>
                <div>CSVæ–‡ä»¶çŠ¶æ€: <span id="csvStatus">-</span></div>
            </div>
        </div>

        <div class="test-section">
            <h2>æ§åˆ¶æŒ‰é’®</h2>
            <button onclick="loadCSVConfig()">åŠ è½½CSVé…ç½®</button>
            <button onclick="loadDefaultConfig()">åŠ è½½é»˜è®¤é…ç½®</button>
            <button onclick="reloadConfig()">é‡æ–°åŠ è½½é…ç½®</button>
            <button onclick="exportConfig()">å¯¼å‡ºé…ç½®</button>
            <button onclick="testGame()">æµ‹è¯•æ¸¸æˆ</button>
        </div>

        <div class="test-section">
            <h2>é…ç½®ä¿¡æ¯</h2>
            <div id="configInfo">
                <!-- é…ç½®ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <div class="test-section">
            <h2>æ¸¸æˆæµ‹è¯•</h2>
            <div class="status">
                <div>ç©å®¶ç”Ÿå‘½: <span id="playerHealth" class="health">30</span></div>
                <div>ç©å®¶æŠ¤ç”²: <span id="playerArmor" class="armor">0</span></div>
                <div>ç©å®¶èƒ½é‡: <span id="playerEnergy" class="energy">5</span></div>
                <div>ç”µè„‘ç”Ÿå‘½: <span id="computerHealth" class="health">30</span></div>
                <div>ç”µè„‘æŠ¤ç”²: <span id="computerArmor" class="armor">0</span></div>
                <div>ç”µè„‘èƒ½é‡: <span id="computerEnergy" class="energy">5</span></div>
            </div>
            <div id="testCards">
                <!-- æµ‹è¯•å¡ç‰Œå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <div class="test-section">
            <h2>æµ‹è¯•æ—¥å¿—</h2>
            <div id="testLog" class="log"></div>
        </div>

        <div class="test-results">
            <h3>æµ‹è¯•ç»“æœ</h3>
            <div id="testResults">
                <p>âœ… CSVé…ç½®ç³»ç»Ÿå·²å®ç°</p>
                <p>âœ… å¼‚æ­¥åŠ è½½åŠŸèƒ½æ­£å¸¸</p>
                <p>âœ… åå¤‡é…ç½®æœºåˆ¶å®Œå–„</p>
            </div>
        </div>
    </div>

    <script src="CardConfig.js"></script>
    <script src="Card.js"></script>
    <script src="GameState.js"></script>
    <script>
        let testGameState = null;
        let configLoaded = false;

        /**
         * åŠ è½½CSVé…ç½®
         */
        async function loadCSVConfig() {
            addLog("ğŸ”„ å¼€å§‹åŠ è½½CSVé…ç½®...");
            
            try {
                const success = await CardConfigManager.loadCardConfigs();
                if (success) {
                    configLoaded = true;
                    updateConfigStatus("CSVæ–‡ä»¶", true);
                    addLog("âœ… CSVé…ç½®åŠ è½½æˆåŠŸ");
                    displayConfigInfo();
                } else {
                    updateConfigStatus("é»˜è®¤é…ç½®", false);
                    addLog("âŒ CSVé…ç½®åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®");
                }
            } catch (error) {
                updateConfigStatus("é»˜è®¤é…ç½®", false);
                addLog(`âŒ CSVé…ç½®åŠ è½½å‡ºé”™: ${error.message}`);
            }
        }

        /**
         * åŠ è½½é»˜è®¤é…ç½®
         */
        function loadDefaultConfig() {
            addLog("ğŸ”„ åŠ è½½é»˜è®¤é…ç½®...");
            
            try {
                const success = CardConfigManager.loadDefaultConfigs();
                if (success) {
                    configLoaded = true;
                    updateConfigStatus("é»˜è®¤é…ç½®", true);
                    addLog("âœ… é»˜è®¤é…ç½®åŠ è½½æˆåŠŸ");
                    displayConfigInfo();
                } else {
                    updateConfigStatus("æ— é…ç½®", false);
                    addLog("âŒ é»˜è®¤é…ç½®åŠ è½½å¤±è´¥");
                }
            } catch (error) {
                updateConfigStatus("æ— é…ç½®", false);
                addLog(`âŒ é»˜è®¤é…ç½®åŠ è½½å‡ºé”™: ${error.message}`);
            }
        }

        /**
         * é‡æ–°åŠ è½½é…ç½®
         */
        async function reloadConfig() {
            addLog("ğŸ”„ é‡æ–°åŠ è½½é…ç½®...");
            
            try {
                CardConfigManager.reloadConfigs();
                const success = await CardConfigManager.loadCardConfigs();
                if (success) {
                    configLoaded = true;
                    updateConfigStatus("CSVæ–‡ä»¶", true);
                    addLog("âœ… é…ç½®é‡æ–°åŠ è½½æˆåŠŸ");
                    displayConfigInfo();
                } else {
                    updateConfigStatus("é»˜è®¤é…ç½®", false);
                    addLog("âŒ é…ç½®é‡æ–°åŠ è½½å¤±è´¥");
                }
            } catch (error) {
                updateConfigStatus("æ— é…ç½®", false);
                addLog(`âŒ é…ç½®é‡æ–°åŠ è½½å‡ºé”™: ${error.message}`);
            }
        }

        /**
         * å¯¼å‡ºé…ç½®
         */
        function exportConfig() {
            if (!CardConfigManager.isConfigLoaded()) {
                addLog("âŒ æ²¡æœ‰å¯å¯¼å‡ºçš„é…ç½®");
                return;
            }

            try {
                const csvData = CardConfigManager.exportToCSV();
                const blob = new Blob([csvData], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'cards_export.csv';
                a.click();
                URL.revokeObjectURL(url);
                
                addLog("âœ… é…ç½®å¯¼å‡ºæˆåŠŸ");
            } catch (error) {
                addLog(`âŒ é…ç½®å¯¼å‡ºå¤±è´¥: ${error.message}`);
            }
        }

        /**
         * æµ‹è¯•æ¸¸æˆ
         */
        async function testGame() {
            if (!configLoaded) {
                addLog("âŒ è¯·å…ˆåŠ è½½é…ç½®");
                return;
            }

            addLog("ğŸ”„ å¼€å§‹æµ‹è¯•æ¸¸æˆ...");
            
            try {
                testGameState = new GameState();
                await testGameState.initializeDeck();
                testGameState.dealInitialCards();
                
                updateGameDisplay();
                addLog("âœ… æ¸¸æˆæµ‹è¯•æˆåŠŸ");
            } catch (error) {
                addLog(`âŒ æ¸¸æˆæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        /**
         * æ›´æ–°é…ç½®çŠ¶æ€æ˜¾ç¤º
         */
        function updateConfigStatus(method, success) {
            document.getElementById('loadStatus').textContent = success ? 'å·²åŠ è½½' : 'æœªåŠ è½½';
            document.getElementById('loadMethod').textContent = method;
            document.getElementById('cardCount').textContent = CardConfigManager.getAllCardConfigs().length;
            document.getElementById('csvStatus').textContent = success ? 'æ­£å¸¸' : 'å¼‚å¸¸';
            
            const statusElement = document.getElementById('loadStatus');
            statusElement.className = success ? 'success' : 'error';
        }

        /**
         * æ˜¾ç¤ºé…ç½®ä¿¡æ¯
         */
        function displayConfigInfo() {
            const configInfo = document.getElementById('configInfo');
            const configs = CardConfigManager.getAllCardConfigs();
            
            configInfo.innerHTML = '';
            
            configs.forEach((config, index) => {
                const configDiv = document.createElement('div');
                configDiv.className = 'config-info';
                configDiv.innerHTML = `
                    <h4>${config.name} (${config.class})</h4>
                    <div><strong>èƒ½é‡æ¶ˆè€—:</strong> ${config.energyCost}</div>
                    <div><strong>æ–½æ³•ç±»å‹:</strong> ${config.castType}</div>
                    <div><strong>æ•ˆæœ:</strong> ${config.effect}</div>
                    <div><strong>æ•ˆæœä»£ç :</strong> ${config.effectCode}</div>
                    <div><strong>æ•°å€¼:</strong> ${config.value1}, ${config.value2}, ${config.value3}</div>
                `;
                configInfo.appendChild(configDiv);
            });
        }

        /**
         * æ›´æ–°æ¸¸æˆæ˜¾ç¤º
         */
        function updateGameDisplay() {
            if (!testGameState) return;

            const info = testGameState.getGameInfo();
            
            document.getElementById('playerHealth').textContent = info.playerHealth;
            document.getElementById('playerArmor').textContent = info.playerArmor;
            document.getElementById('playerEnergy').textContent = info.playerEnergy;
            document.getElementById('computerHealth').textContent = info.computerHealth;
            document.getElementById('computerArmor').textContent = info.computerArmor;
            document.getElementById('computerEnergy').textContent = info.computerEnergy;
            
            updateTestCards();
        }

        /**
         * æ›´æ–°æµ‹è¯•å¡ç‰Œæ˜¾ç¤º
         */
        function updateTestCards() {
            if (!testGameState) return;

            const cardsContainer = document.getElementById('testCards');
            cardsContainer.innerHTML = '';
            
            testGameState.playerHand.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                
                const canPlay = card.canPlay(testGameState.playerEnergy);
                
                if (!canPlay) {
                    cardElement.classList.add('disabled');
                }
                
                cardElement.innerHTML = `
                    <div style="font-weight: bold;">${card.name}</div>
                    <div>èƒ½é‡: ${card.energyCost}</div>
                    <div style="font-size: 9px; margin-top: 5px;">${card.effect}</div>
                `;
                
                if (canPlay) {
                    cardElement.onclick = () => useTestCard(card, index);
                }
                
                cardsContainer.appendChild(cardElement);
            });
        }

        /**
         * ä½¿ç”¨æµ‹è¯•å¡ç‰Œ
         */
        function useTestCard(card, index) {
            if (!testGameState) return;

            const result = testGameState.useCard(card, true);
            
            if (result.success) {
                const combinedMessage = `${result.message} â†’ ${result.effectResult}`;
                addLog(`âœ… ${combinedMessage}`);
                
                updateGameDisplay();
            } else {
                addLog(`âŒ ${result.message}`);
            }
        }

        /**
         * æ·»åŠ æ—¥å¿—
         */
        function addLog(message) {
            const logDiv = document.getElementById('testLog');
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨åŠ è½½é…ç½®
        document.addEventListener('DOMContentLoaded', function() {
            addLog("ğŸ“‹ CSVé…ç½®åŠ è½½æµ‹è¯•é¡µé¢å·²åŠ è½½");
            addLog("æµ‹è¯•è¯´æ˜ï¼š");
            addLog("1. ç‚¹å‡»'åŠ è½½CSVé…ç½®'æµ‹è¯•ä»CSVæ–‡ä»¶åŠ è½½");
            addLog("2. ç‚¹å‡»'åŠ è½½é»˜è®¤é…ç½®'æµ‹è¯•åå¤‡é…ç½®");
            addLog("3. ç‚¹å‡»'æµ‹è¯•æ¸¸æˆ'éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®åº”ç”¨");
            addLog("4. è§‚å¯Ÿé…ç½®ä¿¡æ¯å’Œæ¸¸æˆæµ‹è¯•ç»“æœ");
            
            // è‡ªåŠ¨å°è¯•åŠ è½½CSVé…ç½®
            loadCSVConfig();
        });
    </script>
</body>
</html> 