<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>回合能量恢复测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .success {
            border-left-color: #28a745;
            background-color: #d4edda;
        }
        .error {
            border-left-color: #dc3545;
            background-color: #f8d7da;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .energy-display {
            font-size: 18px;
            font-weight: bold;
            color: #007bff;
        }
        .turn-display {
            font-size: 16px;
            color: #6c757d;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>回合能量恢复测试</h1>
        
        <div class="test-section">
            <h2>当前状态</h2>
            <div class="turn-display">回合: <span id="currentTurn">1</span></div>
            <div class="energy-display">玩家能量: <span id="playerEnergy">1</span></div>
            <div class="energy-display">电脑能量: <span id="computerEnergy">1</span></div>
            <div class="turn-display">当前回合: <span id="isPlayerTurn">玩家</span></div>
        </div>

        <div class="test-section">
            <h2>测试操作</h2>
            <button onclick="testInitialState()">测试初始状态</button>
            <button onclick="testPlayerTurn()">测试玩家回合</button>
            <button onclick="testComputerTurn()">测试电脑回合</button>
            <button onclick="testNewTurn()">测试新回合</button>
            <button onclick="testFullTurnCycle()">测试完整回合循环</button>
            <button onclick="resetTest()">重置测试</button>
        </div>

        <div class="test-section">
            <h2>测试日志</h2>
            <div id="testLog" class="log"></div>
        </div>
    </div>

    <script>
        // 模拟GameState类
        class TestGameState {
            constructor() {
                this.playerEnergy = 1;
                this.computerEnergy = 1;
                this.currentTurn = 1;
                this.isPlayerTurn = true;
            }

            startNewTurn() {
                this.currentTurn++;
                
                // 能量恢复逻辑：每回合能量值等于回合数，最高10点
                const maxEnergy = Math.min(this.currentTurn, 10);
                
                // 新回合开始时，双方都恢复能量
                this.playerEnergy = maxEnergy;
                this.computerEnergy = maxEnergy;
                
                return {
                    turn: this.currentTurn,
                    playerEnergy: this.playerEnergy,
                    computerEnergy: this.computerEnergy
                };
            }

            reset() {
                this.playerEnergy = 1;
                this.computerEnergy = 1;
                this.currentTurn = 1;
                this.isPlayerTurn = true;
            }

            simulatePlayerTurn() {
                // 模拟玩家使用卡牌消耗能量
                if (this.playerEnergy > 0) {
                    this.playerEnergy--;
                    return true;
                }
                return false;
            }

            simulateComputerTurn() {
                // 模拟电脑使用卡牌消耗能量
                if (this.computerEnergy > 0) {
                    this.computerEnergy--;
                    return true;
                }
                return false;
            }
        }

        let testGameState = new TestGameState();

        function updateDisplay() {
            document.getElementById('currentTurn').textContent = testGameState.currentTurn;
            document.getElementById('playerEnergy').textContent = testGameState.playerEnergy;
            document.getElementById('computerEnergy').textContent = testGameState.computerEnergy;
            document.getElementById('isPlayerTurn').textContent = testGameState.isPlayerTurn ? '玩家' : '电脑';
        }

        function addLog(message) {
            const logDiv = document.getElementById('testLog');
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function testInitialState() {
            addLog('=== 测试初始状态 ===');
            
            if (testGameState.playerEnergy === 1 && testGameState.computerEnergy === 1) {
                addLog('✅ 初始能量正确：玩家1点，电脑1点');
            } else {
                addLog('❌ 初始能量错误');
            }
            
            if (testGameState.currentTurn === 1) {
                addLog('✅ 初始回合正确：第1回合');
            } else {
                addLog('❌ 初始回合错误');
            }
            
            if (testGameState.isPlayerTurn === true) {
                addLog('✅ 初始回合类型正确：玩家回合');
            } else {
                addLog('❌ 初始回合类型错误');
            }
        }

        function testPlayerTurn() {
            addLog('=== 测试玩家回合 ===');
            
            const initialEnergy = testGameState.playerEnergy;
            const usedCard = testGameState.simulatePlayerTurn();
            
            if (usedCard) {
                addLog(`✅ 玩家使用卡牌，能量从${initialEnergy}减少到${testGameState.playerEnergy}`);
            } else {
                addLog('❌ 玩家无法使用卡牌，能量不足');
            }
            
            updateDisplay();
        }

        function testComputerTurn() {
            addLog('=== 测试电脑回合 ===');
            
            const initialEnergy = testGameState.computerEnergy;
            const usedCard = testGameState.simulateComputerTurn();
            
            if (usedCard) {
                addLog(`✅ 电脑使用卡牌，能量从${initialEnergy}减少到${testGameState.computerEnergy}`);
            } else {
                addLog('❌ 电脑无法使用卡牌，能量不足');
            }
            
            updateDisplay();
        }

        function testNewTurn() {
            addLog('=== 测试新回合 ===');
            
            const oldTurn = testGameState.currentTurn;
            const oldPlayerEnergy = testGameState.playerEnergy;
            const oldComputerEnergy = testGameState.computerEnergy;
            
            const result = testGameState.startNewTurn();
            
            addLog(`✅ 回合从${oldTurn}增加到${result.turn}`);
            addLog(`✅ 玩家能量从${oldPlayerEnergy}恢复到${result.playerEnergy}`);
            addLog(`✅ 电脑能量从${oldComputerEnergy}恢复到${result.computerEnergy}`);
            
            // 验证能量恢复逻辑
            const expectedEnergy = Math.min(result.turn, 10);
            if (result.playerEnergy === expectedEnergy && result.computerEnergy === expectedEnergy) {
                addLog(`✅ 能量恢复逻辑正确：第${result.turn}回合应该有${expectedEnergy}点能量`);
            } else {
                addLog(`❌ 能量恢复逻辑错误：期望${expectedEnergy}点，实际玩家${result.playerEnergy}点，电脑${result.computerEnergy}点`);
            }
            
            updateDisplay();
        }

        function testFullTurnCycle() {
            addLog('=== 测试完整回合循环 ===');
            
            // 模拟一个完整的回合循环
            addLog('1. 玩家使用卡牌');
            testGameState.simulatePlayerTurn();
            
            addLog('2. 电脑使用卡牌');
            testGameState.simulateComputerTurn();
            
            addLog('3. 开始新回合');
            const result = testGameState.startNewTurn();
            
            addLog(`✅ 完整回合循环完成：第${result.turn}回合，玩家${result.playerEnergy}点能量，电脑${result.computerEnergy}点能量`);
            
            updateDisplay();
        }

        function resetTest() {
            addLog('=== 重置测试 ===');
            testGameState.reset();
            updateDisplay();
            
            if (testGameState.playerEnergy === 1 && testGameState.computerEnergy === 1 && testGameState.currentTurn === 1) {
                addLog('✅ 重置成功：能量和回合数都正确重置');
            } else {
                addLog('❌ 重置失败');
            }
        }

        // 初始化显示
        updateDisplay();
        addLog('回合能量恢复测试页面已加载');
    </script>
</body>
</html> 