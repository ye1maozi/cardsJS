<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BotPlayer AIæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .card {
            display: inline-block;
            width: 150px;
            height: 100px;
            margin: 5px;
            padding: 10px;
            border: 2px solid #007bff;
            border-radius: 8px;
            background-color: #f8f9fa;
            cursor: pointer;
            text-align: center;
            font-size: 11px;
            vertical-align: top;
        }
        .card:hover {
            background-color: #e9ecef;
        }
        .card.disabled {
            border-color: #6c757d;
            background-color: #e9ecef;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .card.used {
            border-color: #28a745;
            background-color: #d4edda;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background-color: #e9ecef;
        }
        .health {
            color: #dc3545;
            font-weight: bold;
        }
        .armor {
            color: #17a2b8;
            font-weight: bold;
        }
        .energy {
            color: #ffc107;
            font-weight: bold;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
        }
        .ai-info {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        .ai-info h4 {
            margin: 0 0 10px 0;
            color: #007bff;
        }
        .personality-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }
        .personality-fill {
            height: 100%;
            background-color: #007bff;
            transition: width 0.3s ease;
        }
        .strategy-info {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff3cd;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .warning {
            color: #ffc107;
            font-weight: bold;
        }
        .info {
            color: #17a2b8;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>BotPlayer AIæµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>AIæ§åˆ¶</h2>
            <div class="status">
                <div>AIéš¾åº¦: <span id="aiDifficulty">normal</span></div>
                <div>AIçŠ¶æ€: <span id="aiStatus">å·²åˆå§‹åŒ–</span></div>
                <div>æµ‹è¯•å›åˆ: <span id="testTurn">0</span></div>
            </div>
            <button onclick="setDifficulty('easy')">ç®€å•æ¨¡å¼</button>
            <button onclick="setDifficulty('normal')">æ™®é€šæ¨¡å¼</button>
            <button onclick="setDifficulty('hard')">å›°éš¾æ¨¡å¼</button>
            <button onclick="resetAI()">é‡ç½®AI</button>
            <button onclick="runAITest()">è¿è¡ŒAIæµ‹è¯•</button>
        </div>

        <div class="test-section">
            <h2>AIä¸ªæ€§åˆ†æ</h2>
            <div id="personalityInfo">
                <!-- AIä¸ªæ€§ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <div class="test-section">
            <h2>ç­–ç•¥åˆ†æ</h2>
            <div id="strategyInfo">
                <!-- ç­–ç•¥åˆ†æä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <div class="test-section">
            <h2>æ¸¸æˆçŠ¶æ€</h2>
            <div class="status">
                <div>ç©å®¶ç”Ÿå‘½: <span id="playerHealth" class="health">30</span></div>
                <div>ç©å®¶æŠ¤ç”²: <span id="playerArmor" class="armor">0</span></div>
                <div>ç©å®¶èƒ½é‡: <span id="playerEnergy" class="energy">5</span></div>
                <div>ç”µè„‘ç”Ÿå‘½: <span id="computerHealth" class="health">30</span></div>
                <div>ç”µè„‘æŠ¤ç”²: <span id="computerArmor" class="armor">0</span></div>
                <div>ç”µè„‘èƒ½é‡: <span id="computerEnergy" class="energy">5</span></div>
            </div>
            <button onclick="adjustPlayerHealth(-10)">å‡å°‘ç©å®¶ç”Ÿå‘½</button>
            <button onclick="adjustPlayerHealth(10)">å¢åŠ ç©å®¶ç”Ÿå‘½</button>
            <button onclick="adjustComputerHealth(-10)">å‡å°‘ç”µè„‘ç”Ÿå‘½</button>
            <button onclick="adjustComputerHealth(10)">å¢åŠ ç”µè„‘ç”Ÿå‘½</button>
        </div>

        <div class="test-section">
            <h2>ç”µè„‘æ‰‹ç‰Œ</h2>
            <div id="computerHand">
                <!-- ç”µè„‘æ‰‹ç‰Œå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <div class="test-section">
            <h2>AIå†³ç­–æµ‹è¯•</h2>
            <button onclick="testAIDecision()">æµ‹è¯•AIå†³ç­–</button>
            <button onclick="runMultipleTests()">è¿è¡Œå¤šæ¬¡æµ‹è¯•</button>
            <div id="decisionResults">
                <!-- AIå†³ç­–ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <div class="test-section">
            <h2>æµ‹è¯•æ—¥å¿—</h2>
            <div id="testLog" class="log"></div>
        </div>

        <div class="test-results">
            <h3>æµ‹è¯•ç»“æœ</h3>
            <div id="testResults">
                <p>âœ… BotPlayer AIç³»ç»Ÿå·²å®ç°</p>
                <p>âœ… æ™ºèƒ½å†³ç­–æœºåˆ¶æ­£å¸¸</p>
                <p>âœ… ä¸ªæ€§ç³»ç»Ÿå·¥ä½œæ­£å¸¸</p>
            </div>
        </div>
    </div>

    <script src="CardConfig.js"></script>
    <script src="Card.js"></script>
    <script src="BotPlayer.js"></script>
    <script src="GameState.js"></script>
    <script>
        let testGameState = null;
        let botPlayer = null;
        let testTurn = 0;

        /**
         * åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ
         */
        function initializeTest() {
            if (!testGameState) {
                testGameState = new GameState();
                testGameState.initializeDeck();
                testGameState.dealInitialCards();
                botPlayer = new BotPlayer(testGameState);
                addLog("ğŸ”§ æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ");
            }
        }

        /**
         * è®¾ç½®AIéš¾åº¦
         */
        function setDifficulty(difficulty) {
            initializeTest();
            botPlayer.setDifficulty(difficulty);
            document.getElementById('aiDifficulty').textContent = difficulty;
            addLog(`âš™ï¸ AIéš¾åº¦è®¾ç½®ä¸º: ${difficulty}`);
            updatePersonalityInfo();
        }

        /**
         * é‡ç½®AI
         */
        function resetAI() {
            if (botPlayer) {
                botPlayer.reset();
                addLog("ğŸ”„ AIå·²é‡ç½®");
                updatePersonalityInfo();
            }
        }

        /**
         * è¿è¡ŒAIæµ‹è¯•
         */
        function runAITest() {
            initializeTest();
            addLog("ğŸ§ª å¼€å§‹AIæµ‹è¯•...");
            
            // æ¨¡æ‹Ÿå¤šä¸ªå›åˆçš„AIå†³ç­–
            for (let i = 0; i < 5; i++) {
                testTurn++;
                document.getElementById('testTurn').textContent = testTurn;
                
                // ç»™ç”µè„‘ä¸€äº›æ‰‹ç‰Œ
                testGameState.computerHand = generateTestHand();
                testGameState.computerEnergy = Math.floor(Math.random() * 5) + 1;
                
                // æ‰§è¡ŒAIå†³ç­–
                const result = botPlayer.executeTurn();
                addLog(`å›åˆ ${testTurn}: ${result}`);
                
                updateGameDisplay();
                updateStrategyInfo();
            }
            
            addLog("âœ… AIæµ‹è¯•å®Œæˆ");
        }

        /**
         * ç”Ÿæˆæµ‹è¯•æ‰‹ç‰Œ
         */
        function generateTestHand() {
            const allCards = [
                new Card("æ‰“å‡»", "æˆ˜å£«", 1, 0, "ç¬å‘", "å¯¹å•ä½“ç›®æ ‡é€ æˆ6ç‚¹ä¼¤å®³", "DAMAGE_6", 6, 0, 0),
                new Card("ç«çƒæœ¯", "æ³•å¸ˆ", 2, 0, "1ç§’", "å¯¹å•ä½“ç›®æ ‡é€ æˆ8ç‚¹ä¼¤å®³", "DAMAGE_8", 8, 0, 0),
                new Card("æ²»ç–—æœ¯", "ç‰§å¸ˆ", 1, 0, "ç¬å‘", "æ¢å¤6ç‚¹ç”Ÿå‘½å€¼", "HEAL_6", 6, 0, 0),
                new Card("ç›¾å‡»", "æˆ˜å£«", 2, 0, "ç¬å‘", "å¯¹å•ä½“ç›®æ ‡é€ æˆ4ç‚¹ä¼¤å®³ï¼Œå¹¶è·å¾—3ç‚¹æŠ¤ç”²", "DAMAGE_4_ARMOR", 4, 3, 0),
                new Card("ç¥åœ£æ–°æ˜Ÿ", "ç‰§å¸ˆ", 2, 0, "ç¬å‘", "å¯¹æ‰€æœ‰å‹å†›æ¢å¤4ç‚¹ç”Ÿå‘½å€¼", "HEAL_4_ALL", 4, 0, 0)
            ];
            
            const hand = [];
            const handSize = Math.floor(Math.random() * 3) + 2; // 2-4å¼ å¡ç‰Œ
            
            for (let i = 0; i < handSize; i++) {
                const randomCard = allCards[Math.floor(Math.random() * allCards.length)];
                hand.push(new Card(
                    randomCard.name,
                    randomCard.class,
                    randomCard.energyCost,
                    randomCard.castTime,
                    randomCard.castType,
                    randomCard.effect,
                    randomCard.effectCode,
                    randomCard.value1,
                    randomCard.value2,
                    randomCard.value3
                ));
            }
            
            return hand;
        }

        /**
         * æµ‹è¯•AIå†³ç­–
         */
        function testAIDecision() {
            initializeTest();
            
            // è®¾ç½®ç‰¹å®šåœºæ™¯
            testGameState.computerHand = generateTestHand();
            testGameState.computerEnergy = 3;
            
            addLog("ğŸ¯ æµ‹è¯•AIå†³ç­–...");
            addLog(`ç”µè„‘æ‰‹ç‰Œ: ${testGameState.computerHand.map(c => c.name).join(', ')}`);
            addLog(`ç”µè„‘èƒ½é‡: ${testGameState.computerEnergy}`);
            
            const result = botPlayer.executeTurn();
            addLog(`AIå†³ç­–ç»“æœ: ${result}`);
            
            updateGameDisplay();
            updateStrategyInfo();
        }

        /**
         * è¿è¡Œå¤šæ¬¡æµ‹è¯•
         */
        function runMultipleTests() {
            initializeTest();
            addLog("ğŸ“Š è¿è¡Œå¤šæ¬¡AIæµ‹è¯•...");
            
            const results = {
                damage: 0,
                heal: 0,
                armor: 0,
                other: 0
            };
            
            for (let i = 0; i < 20; i++) {
                testGameState.computerHand = generateTestHand();
                testGameState.computerEnergy = Math.floor(Math.random() * 5) + 1;
                
                const result = botPlayer.executeTurn();
                
                if (result.includes('ä¼¤å®³')) {
                    results.damage++;
                } else if (result.includes('æ¢å¤') || result.includes('æ²»ç–—')) {
                    results.heal++;
                } else if (result.includes('æŠ¤ç”²')) {
                    results.armor++;
                } else {
                    results.other++;
                }
            }
            
            addLog(`ğŸ“ˆ æµ‹è¯•ç»“æœç»Ÿè®¡:`);
            addLog(`  ä¼¤å®³å¡ç‰Œ: ${results.damage}æ¬¡`);
            addLog(`  æ²»ç–—å¡ç‰Œ: ${results.heal}æ¬¡`);
            addLog(`  æŠ¤ç”²å¡ç‰Œ: ${results.armor}æ¬¡`);
            addLog(`  å…¶ä»–å¡ç‰Œ: ${results.other}æ¬¡`);
        }

        /**
         * è°ƒæ•´ç©å®¶ç”Ÿå‘½
         */
        function adjustPlayerHealth(amount) {
            initializeTest();
            testGameState.playerHealth = Math.max(0, Math.min(30, testGameState.playerHealth + amount));
            addLog(`â¤ï¸ ç©å®¶ç”Ÿå‘½è°ƒæ•´ä¸º: ${testGameState.playerHealth}`);
            updateGameDisplay();
            updateStrategyInfo();
        }

        /**
         * è°ƒæ•´ç”µè„‘ç”Ÿå‘½
         */
        function adjustComputerHealth(amount) {
            initializeTest();
            testGameState.computerHealth = Math.max(0, Math.min(30, testGameState.computerHealth + amount));
            addLog(`ğŸ’™ ç”µè„‘ç”Ÿå‘½è°ƒæ•´ä¸º: ${testGameState.computerHealth}`);
            updateGameDisplay();
            updateStrategyInfo();
        }

        /**
         * æ›´æ–°æ¸¸æˆæ˜¾ç¤º
         */
        function updateGameDisplay() {
            if (!testGameState) return;

            document.getElementById('playerHealth').textContent = testGameState.playerHealth;
            document.getElementById('playerArmor').textContent = testGameState.playerArmor;
            document.getElementById('playerEnergy').textContent = testGameState.playerEnergy;
            document.getElementById('computerHealth').textContent = testGameState.computerHealth;
            document.getElementById('computerArmor').textContent = testGameState.computerArmor;
            document.getElementById('computerEnergy').textContent = testGameState.computerEnergy;
            
            updateComputerHand();
        }

        /**
         * æ›´æ–°ç”µè„‘æ‰‹ç‰Œæ˜¾ç¤º
         */
        function updateComputerHand() {
            if (!testGameState) return;

            const handContainer = document.getElementById('computerHand');
            handContainer.innerHTML = '';
            
            testGameState.computerHand.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                
                const canPlay = card.energyCost <= testGameState.computerEnergy;
                
                if (!canPlay) {
                    cardElement.classList.add('disabled');
                }
                
                cardElement.innerHTML = `
                    <div style="font-weight: bold;">${card.name}</div>
                    <div>èƒ½é‡: ${card.energyCost}</div>
                    <div style="font-size: 9px; margin-top: 5px;">${card.effect}</div>
                `;
                
                handContainer.appendChild(cardElement);
            });
        }

        /**
         * æ›´æ–°ä¸ªæ€§ä¿¡æ¯æ˜¾ç¤º
         */
        function updatePersonalityInfo() {
            if (!botPlayer) return;

            const personality = botPlayer.personality;
            const status = botPlayer.getStatus();
            
            const infoDiv = document.getElementById('personalityInfo');
            infoDiv.innerHTML = `
                <h4>AIä¸ªæ€§ç‰¹å¾</h4>
                <div>æ”»å‡»æ€§: ${(personality.aggressiveness * 100).toFixed(1)}%
                    <div class="personality-bar">
                        <div class="personality-fill" style="width: ${personality.aggressiveness * 100}%"></div>
                    </div>
                </div>
                <div>é˜²å¾¡æ€§: ${(personality.defensiveness * 100).toFixed(1)}%
                    <div class="personality-bar">
                        <div class="personality-fill" style="width: ${personality.defensiveness * 100}%"></div>
                    </div>
                </div>
                <div>æ•ˆç‡æ€§: ${(personality.efficiency * 100).toFixed(1)}%
                    <div class="personality-bar">
                        <div class="personality-fill" style="width: ${personality.efficiency * 100}%"></div>
                    </div>
                </div>
                <div>é£é™©æ‰¿å—åº¦: ${(personality.riskTolerance * 100).toFixed(1)}%
                    <div class="personality-bar">
                        <div class="personality-fill" style="width: ${personality.riskTolerance * 100}%"></div>
                    </div>
                </div>
                <div>é€‚åº”æ€§: ${(personality.adaptability * 100).toFixed(1)}%
                    <div class="personality-bar">
                        <div class="personality-fill" style="width: ${personality.adaptability * 100}%"></div>
                    </div>
                </div>
                <div><strong>éš¾åº¦:</strong> ${status.difficulty}</div>
                <div><strong>è®°å¿†å¤§å°:</strong> ${status.memorySize.healthHistory} æ¡å†å²è®°å½•</div>
            `;
        }

        /**
         * æ›´æ–°ç­–ç•¥ä¿¡æ¯æ˜¾ç¤º
         */
        function updateStrategyInfo() {
            if (!botPlayer || !testGameState) return;

            const strategy = botPlayer.analyzeSituation();
            
            const strategyDiv = document.getElementById('strategyInfo');
            strategyDiv.innerHTML = `
                <h4>å½“å‰ç­–ç•¥åˆ†æ</h4>
                <div class="strategy-info">
                    <div><strong>ç©å®¶è¡€é‡æ¯”ä¾‹:</strong> ${(strategy.playerHealthRatio * 100).toFixed(1)}%</div>
                    <div><strong>ç”µè„‘è¡€é‡æ¯”ä¾‹:</strong> ${(strategy.computerHealthRatio * 100).toFixed(1)}%</div>
                    <div><strong>èƒ½é‡æ•ˆç‡:</strong> ${(strategy.energyEfficiency * 100).toFixed(1)}%</div>
                    <div><strong>å¡ç‰Œä¼˜åŠ¿:</strong> ${strategy.cardAdvantage}</div>
                    <div><strong>ç”µè„‘å±é™©:</strong> <span class="${strategy.isInDanger ? 'error' : 'success'}">${strategy.isInDanger ? 'æ˜¯' : 'å¦'}</span></div>
                    <div><strong>ç©å®¶å±é™©:</strong> <span class="${strategy.isPlayerInDanger ? 'warning' : 'success'}">${strategy.isPlayerInDanger ? 'æ˜¯' : 'å¦'}</span></div>
                    <div><strong>å¯ä»¥ç»ˆç»“:</strong> <span class="${strategy.canFinishPlayer ? 'error' : 'info'}">${strategy.canFinishPlayer ? 'æ˜¯' : 'å¦'}</span></div>
                    <div><strong>åº”è¯¥é˜²å¾¡:</strong> <span class="${strategy.shouldDefend ? 'warning' : 'info'}">${strategy.shouldDefend ? 'æ˜¯' : 'å¦'}</span></div>
                    <div><strong>åº”è¯¥æ”»å‡»:</strong> <span class="${strategy.shouldAggress ? 'error' : 'info'}">${strategy.shouldAggress ? 'æ˜¯' : 'å¦'}</span></div>
                </div>
            `;
        }

        /**
         * æ·»åŠ æ—¥å¿—
         */
        function addLog(message) {
            const logDiv = document.getElementById('testLog');
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog("ğŸ¤– BotPlayer AIæµ‹è¯•é¡µé¢å·²åŠ è½½");
            addLog("æµ‹è¯•è¯´æ˜ï¼š");
            addLog("1. è®¾ç½®AIéš¾åº¦ï¼ˆç®€å•/æ™®é€š/å›°éš¾ï¼‰");
            addLog("2. è°ƒæ•´æ¸¸æˆçŠ¶æ€æµ‹è¯•AIååº”");
            addLog("3. è¿è¡ŒAIæµ‹è¯•è§‚å¯Ÿå†³ç­–è¿‡ç¨‹");
            addLog("4. æŸ¥çœ‹ä¸ªæ€§åˆ†æå’Œç­–ç•¥åˆ†æ");
            
            // è‡ªåŠ¨åˆå§‹åŒ–
            initializeTest();
            updatePersonalityInfo();
            updateStrategyInfo();
        });
    </script>
</body>
</html> 