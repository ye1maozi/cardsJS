<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çˆ¬å¡”èŠ‚ç‚¹é…ç½®æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .config-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .config-name {
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        .config-details {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }
        .icon {
            font-size: 24px;
            margin-right: 10px;
        }
        .test-log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            line-height: 1.4;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
    </style>
</head>
<body>
    <h1>çˆ¬å¡”èŠ‚ç‚¹é…ç½®æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2 class="test-title">ğŸ—ï¸ é…ç½®åŠ è½½æµ‹è¯•</h2>
        <button class="test-button" onclick="testConfigLoading()">æµ‹è¯•é…ç½®åŠ è½½</button>
        <div id="configLoadResult" class="test-log"></div>
    </div>

    <div class="test-section">
        <h2 class="test-title">ğŸ‘¹ Bossé…ç½®æ•°æ®</h2>
        <button class="test-button" onclick="displayBossConfigs()">æ˜¾ç¤ºBossé…ç½®</button>
        <div id="bossConfigs"></div>
    </div>

    <div class="test-section">
        <h2 class="test-title">ğŸª å•†åº—ç‰©å“é…ç½®</h2>
        <button class="test-button" onclick="displayShopConfigs()">æ˜¾ç¤ºå•†åº—é…ç½®</button>
        <div id="shopConfigs"></div>
    </div>

    <div class="test-section">
        <h2 class="test-title">â“ éšæœºäº‹ä»¶é…ç½®</h2>
        <button class="test-button" onclick="displayEventConfigs()">æ˜¾ç¤ºäº‹ä»¶é…ç½®</button>
        <div id="eventConfigs"></div>
    </div>

    <div class="test-section">
        <h2 class="test-title">ğŸ¯ èŠ‚ç‚¹ç”Ÿæˆæµ‹è¯•</h2>
        <button class="test-button" onclick="testNodeGeneration()">æµ‹è¯•èŠ‚ç‚¹ç”Ÿæˆ</button>
        <div id="nodeGenerationResult" class="test-log"></div>
    </div>

    <div class="test-section">
        <h2 class="test-title">ğŸ—ºï¸ åœ°å›¾ç”Ÿæˆæµ‹è¯•</h2>
        <button class="test-button" onclick="testMapGeneration()">ç”Ÿæˆæµ‹è¯•åœ°å›¾</button>
        <div id="mapGenerationResult" class="test-log"></div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script src="../js/ConfigData.js"></script>
    <script src="../js/TowerConfigManager.js"></script>
    <script src="../js/TowerSystem.js"></script>

    <script>
        let testMapSystem = null;
        
        function log(containerId, message, isError = false) {
            const container = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            const className = isError ? 'error' : 'success';
            container.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            container.scrollTop = container.scrollHeight;
        }

        function clearLog(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        function testConfigLoading() {
            clearLog('configLoadResult');
            
            try {
                log('configLoadResult', 'å¼€å§‹æµ‹è¯•é…ç½®åŠ è½½...');
                
                // æµ‹è¯•ConfigDataæ˜¯å¦åŠ è½½
                if (typeof window.ConfigData === 'undefined') {
                    log('configLoadResult', 'âŒ ConfigDataæœªåŠ è½½', true);
                    return;
                }
                log('configLoadResult', 'âœ… ConfigDataåŠ è½½æˆåŠŸ');
                
                // æµ‹è¯•å„ä¸ªé…ç½®æ•°æ®
                const configs = [
                    'BOSS_CONFIG_DATA',
                    'SHOP_ITEM_DATA', 
                    'RANDOM_EVENT_DATA',
                    'TOWER_NODE_TYPES_DATA',
                    'TOWER_REWARDS_DATA'
                ];
                
                configs.forEach(configName => {
                    if (window.ConfigData[configName]) {
                        const length = window.ConfigData[configName].length;
                        log('configLoadResult', `âœ… ${configName}: ${length} é¡¹é…ç½®`);
                    } else {
                        log('configLoadResult', `âŒ ${configName}: æœªæ‰¾åˆ°`, true);
                    }
                });
                
                // æµ‹è¯•TowerConfigåˆå§‹åŒ–
                if (typeof window.TowerConfig !== 'undefined') {
                    window.TowerConfig.loadSync();
                    log('configLoadResult', 'âœ… TowerConfigåˆå§‹åŒ–æˆåŠŸ');
                } else {
                    log('configLoadResult', 'âŒ TowerConfigæœªåŠ è½½', true);
                }
                
                log('configLoadResult', 'é…ç½®åŠ è½½æµ‹è¯•å®Œæˆï¼');
                
            } catch (error) {
                log('configLoadResult', `âŒ é…ç½®åŠ è½½å¤±è´¥: ${error.message}`, true);
            }
        }

        function displayBossConfigs() {
            const container = document.getElementById('bossConfigs');
            container.innerHTML = '';
            
            if (!window.ConfigData || !window.ConfigData.BOSS_CONFIG_DATA) {
                container.innerHTML = '<div class="error">Bossé…ç½®æ•°æ®æœªåŠ è½½</div>';
                return;
            }
            
            window.ConfigData.BOSS_CONFIG_DATA.forEach(boss => {
                const div = document.createElement('div');
                div.className = 'config-item';
                div.innerHTML = `
                    <div class="config-name">
                        <span class="icon">${boss.icon || 'ğŸ‘¹'}</span>
                        ${boss.name} (éš¾åº¦: ${boss.difficulty})
                    </div>
                    <div class="config-details">
                        <strong>èŒä¸š:</strong> ${boss.class}<br>
                        <strong>ç”Ÿå‘½å€¼:</strong> ${boss.maxHealth}<br>
                        <strong>èƒ½é‡:</strong> ${boss.maxEnergy}<br>
                        <strong>å±æ€§:</strong> åŠ›é‡${boss.strength} æ•æ·${boss.agility} ç²¾ç¥${boss.spirit}<br>
                        <strong>æè¿°:</strong> ${boss.description}<br>
                        <strong>AIç­–ç•¥:</strong> ${boss.aiStrategy || 'é»˜è®¤'}
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function displayShopConfigs() {
            const container = document.getElementById('shopConfigs');
            container.innerHTML = '';
            
            if (!window.ConfigData || !window.ConfigData.SHOP_ITEM_DATA) {
                container.innerHTML = '<div class="error">å•†åº—é…ç½®æ•°æ®æœªåŠ è½½</div>';
                return;
            }
            
            window.ConfigData.SHOP_ITEM_DATA.forEach(item => {
                const div = document.createElement('div');
                div.className = 'config-item';
                div.innerHTML = `
                    <div class="config-name">
                        <span class="icon">${item.icon || 'ğŸ›ï¸'}</span>
                        ${item.name} - ${item.price}é‡‘å¸
                    </div>
                    <div class="config-details">
                        <strong>ç±»å‹:</strong> ${item.type}<br>
                        <strong>æè¿°:</strong> ${item.description}<br>
                        <strong>æ•ˆæœ:</strong> ${JSON.stringify(item.effect)}
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function displayEventConfigs() {
            const container = document.getElementById('eventConfigs');
            container.innerHTML = '';
            
            if (!window.ConfigData || !window.ConfigData.RANDOM_EVENT_DATA) {
                container.innerHTML = '<div class="error">äº‹ä»¶é…ç½®æ•°æ®æœªåŠ è½½</div>';
                return;
            }
            
            window.ConfigData.RANDOM_EVENT_DATA.forEach(event => {
                const div = document.createElement('div');
                div.className = 'config-item';
                div.innerHTML = `
                    <div class="config-name">
                        <span class="icon">${event.icon || 'â“'}</span>
                        ${event.name}
                    </div>
                    <div class="config-details">
                        <strong>æè¿°:</strong> ${event.description}<br>
                        <strong>é€‰æ‹©æ•°é‡:</strong> ${event.choices.length}<br>
                        ${event.choices.map((choice, index) => 
                            `<strong>é€‰æ‹©${index + 1}:</strong> ${choice.text}`
                        ).join('<br>')}
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function testNodeGeneration() {
            clearLog('nodeGenerationResult');
            
            try {
                log('nodeGenerationResult', 'å¼€å§‹æµ‹è¯•èŠ‚ç‚¹ç”Ÿæˆ...');
                
                if (!window.TowerConfig.isLoaded) {
                    window.TowerConfig.loadSync();
                }
                
                testMapSystem = new MapSystem();
                
                // æµ‹è¯•BossèŠ‚ç‚¹ç”Ÿæˆ
                log('nodeGenerationResult', 'æµ‹è¯•BossèŠ‚ç‚¹ç”Ÿæˆ:');
                const bossConfig = testMapSystem.getBossConfig(8);
                log('nodeGenerationResult', `Boss: ${bossConfig.name} (ç”Ÿå‘½å€¼: ${bossConfig.maxHealth})`);
                
                // æµ‹è¯•ç²¾è‹±æ€ªç‰©ç”Ÿæˆ
                log('nodeGenerationResult', 'æµ‹è¯•ç²¾è‹±æ€ªç‰©ç”Ÿæˆ:');
                const eliteConfig = testMapSystem.getEliteMonster(5);
                log('nodeGenerationResult', `ç²¾è‹±: ${eliteConfig.name} (ç”Ÿå‘½å€¼: ${eliteConfig.maxHealth})`);
                
                // æµ‹è¯•å•†åº—ç‰©å“ç”Ÿæˆ
                log('nodeGenerationResult', 'æµ‹è¯•å•†åº—ç‰©å“ç”Ÿæˆ:');
                const shopItems = testMapSystem.generateShopItems(3);
                shopItems.forEach(item => {
                    log('nodeGenerationResult', `å•†åº—ç‰©å“: ${item.name} - ${item.price}é‡‘å¸`);
                });
                
                // æµ‹è¯•éšæœºäº‹ä»¶ç”Ÿæˆ
                log('nodeGenerationResult', 'æµ‹è¯•éšæœºäº‹ä»¶ç”Ÿæˆ:');
                const eventConfig = testMapSystem.getRandomEvent(4);
                log('nodeGenerationResult', `äº‹ä»¶: ${eventConfig.name}`);
                
                log('nodeGenerationResult', 'âœ… èŠ‚ç‚¹ç”Ÿæˆæµ‹è¯•å®Œæˆï¼');
                
            } catch (error) {
                log('nodeGenerationResult', `âŒ èŠ‚ç‚¹ç”Ÿæˆæµ‹è¯•å¤±è´¥: ${error.message}`, true);
            }
        }

        function testMapGeneration() {
            clearLog('mapGenerationResult');
            
            try {
                log('mapGenerationResult', 'å¼€å§‹ç”Ÿæˆæµ‹è¯•åœ°å›¾...');
                
                if (!window.TowerConfig.isLoaded) {
                    window.TowerConfig.loadSync();
                }
                
                testMapSystem = new MapSystem();
                testMapSystem.generateMap();
                
                const mapData = testMapSystem.getMapData();
                
                log('mapGenerationResult', `âœ… åœ°å›¾ç”ŸæˆæˆåŠŸï¼æ€»å±‚æ•°: ${mapData.totalLayers}`);
                
                mapData.layers.forEach((layer, index) => {
                    log('mapGenerationResult', `ç¬¬${index}å±‚: ${layer.length}ä¸ªèŠ‚ç‚¹`);
                    layer.forEach(node => {
                        log('mapGenerationResult', `  - ${node.icon} ${node.displayName} (${node.type})`);
                    });
                });
                
                // ç»Ÿè®¡èŠ‚ç‚¹ç±»å‹
                const nodeTypeCount = {};
                mapData.layers.forEach(layer => {
                    layer.forEach(node => {
                        nodeTypeCount[node.type] = (nodeTypeCount[node.type] || 0) + 1;
                    });
                });
                
                log('mapGenerationResult', 'èŠ‚ç‚¹ç±»å‹ç»Ÿè®¡:');
                Object.entries(nodeTypeCount).forEach(([type, count]) => {
                    log('mapGenerationResult', `  ${type}: ${count}ä¸ª`);
                });
                
                log('mapGenerationResult', 'âœ… åœ°å›¾ç”Ÿæˆæµ‹è¯•å®Œæˆï¼');
                
            } catch (error) {
                log('mapGenerationResult', `âŒ åœ°å›¾ç”Ÿæˆæµ‹è¯•å¤±è´¥: ${error.message}`, true);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œé…ç½®æµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(() => {
                testConfigLoading();
            }, 500);
        });
    </script>
</body>
</html> 