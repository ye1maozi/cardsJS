<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>伤害护甲系统测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .status-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .player-status, .computer-status {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .player-status {
            background-color: #e3f2fd;
        }
        .computer-status {
            background-color: #fff3e0;
        }
    </style>
</head>
<body>
    <h1>伤害护甲系统测试</h1>
    
    <div class="test-container">
        <h2>测试说明</h2>
        <p>此测试验证伤害系统是否正确扣除血量，以及护甲系统是否正常工作。</p>
        <ul>
            <li>测试1：直接伤害是否扣除血量</li>
            <li>测试2：护甲是否减免伤害</li>
            <li>测试3：护甲是否被正确消耗</li>
            <li>测试4：卡牌伤害是否正常工作</li>
        </ul>
    </div>

    <div class="test-container">
        <h2>当前状态</h2>
        <div class="status-display">
            <div class="player-status">
                <h3>玩家状态</h3>
                <p>生命值: <span id="playerHealth">30</span></p>
                <p>护甲值: <span id="playerArmor">0</span></p>
                <p>能量值: <span id="playerEnergy">3</span></p>
            </div>
            <div class="computer-status">
                <h3>电脑状态</h3>
                <p>生命值: <span id="computerHealth">30</span></p>
                <p>护甲值: <span id="computerArmor">0</span></p>
                <p>能量值: <span id="computerEnergy">3</span></p>
            </div>
        </div>
    </div>

    <div class="test-container">
        <h2>测试控制</h2>
        <button onclick="testDirectDamage()">测试直接伤害</button>
        <button onclick="testArmorProtection()">测试护甲保护</button>
        <button onclick="testCardDamage()">测试卡牌伤害</button>
        <button onclick="resetTest()">重置测试</button>
    </div>

    <div id="testResults"></div>

    <!-- JavaScript文件 -->
    <script src="../js/Character.js"></script>
    <script src="../js/CastingSystem.js"></script>
    <script src="../js/Card.js"></script>
    <script src="../js/CardConfig.js"></script>
    <script src="../js/BotPlayer.js"></script>
    <script src="../js/GameState.js"></script>
    <script src="../js/GameUI.js"></script>
    <script src="../js/Game.js"></script>
    <script src="../js/main.js"></script>

    <script>
        let gameState;
        let testResults = [];

        // 初始化测试
        function initTest() {
            gameState = new GameState();
            updateStatusDisplay();
            addTestResult('info', '测试环境已初始化');
        }

        // 更新状态显示
        function updateStatusDisplay() {
            document.getElementById('playerHealth').textContent = gameState.playerHealth;
            document.getElementById('playerArmor').textContent = gameState.playerArmor;
            document.getElementById('playerEnergy').textContent = gameState.playerEnergy;
            document.getElementById('computerHealth').textContent = gameState.computerHealth;
            document.getElementById('computerArmor').textContent = gameState.computerArmor;
            document.getElementById('computerEnergy').textContent = gameState.computerEnergy;
        }

        // 添加测试结果
        function addTestResult(type, message) {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            resultsDiv.appendChild(resultDiv);
            testResults.push({ type, message, time: new Date() });
        }

        // 测试直接伤害
        function testDirectDamage() {
            addTestResult('info', '开始测试直接伤害...');
            
            const initialHealth = gameState.playerHealth;
            gameState.playerCharacter.takeDamage(5);
            gameState.playerHealth = gameState.playerCharacter.currentHealth;
            
            const finalHealth = gameState.playerHealth;
            const damageDealt = initialHealth - finalHealth;
            
            if (damageDealt === 5) {
                addTestResult('success', `直接伤害测试通过：造成5点伤害，血量从${initialHealth}降至${finalHealth}`);
            } else {
                addTestResult('error', `直接伤害测试失败：期望造成5点伤害，实际造成${damageDealt}点伤害`);
            }
            
            updateStatusDisplay();
        }

        // 测试护甲保护
        function testArmorProtection() {
            addTestResult('info', '开始测试护甲保护...');
            
            // 给玩家添加护甲
            gameState.playerArmor = 3;
            updateStatusDisplay();
            
            const initialHealth = gameState.playerHealth;
            const initialArmor = gameState.playerArmor;
            
            gameState.playerCharacter.takeDamage(5);
            gameState.playerHealth = gameState.playerCharacter.currentHealth;
            
            const finalHealth = gameState.playerHealth;
            const finalArmor = gameState.playerArmor;
            const damageDealt = initialHealth - finalHealth;
            const armorConsumed = initialArmor - finalArmor;
            
            if (damageDealt === 2 && armorConsumed === 3) {
                addTestResult('success', `护甲保护测试通过：5点伤害被3点护甲减免，实际造成2点伤害，护甲被完全消耗`);
            } else {
                addTestResult('error', `护甲保护测试失败：期望造成2点伤害，实际造成${damageDealt}点伤害，护甲消耗${armorConsumed}点`);
            }
            
            updateStatusDisplay();
        }

        // 测试卡牌伤害
        function testCardDamage() {
            addTestResult('info', '开始测试卡牌伤害...');
            
            // 创建一张伤害卡牌
            const damageCard = new Card("测试打击", "战士", 1, 0, "瞬发", "对单体目标造成6点伤害", "DAMAGE_6", 6, 0, 0);
            
            const initialHealth = gameState.computerHealth;
            
            // 使用卡牌
            const result = gameState.useCard(damageCard, true);
            
            const finalHealth = gameState.computerHealth;
            const damageDealt = initialHealth - finalHealth;
            
            if (result.success && damageDealt === 6) {
                addTestResult('success', `卡牌伤害测试通过：${damageCard.name}造成6点伤害，血量从${initialHealth}降至${finalHealth}`);
            } else {
                addTestResult('error', `卡牌伤害测试失败：期望造成6点伤害，实际造成${damageDealt}点伤害，使用结果：${result.message}`);
            }
            
            updateStatusDisplay();
        }

        // 重置测试
        function resetTest() {
            gameState = new GameState();
            updateStatusDisplay();
            document.getElementById('testResults').innerHTML = '';
            testResults = [];
            addTestResult('info', '测试已重置');
        }

        // 页面加载完成后初始化
        window.addEventListener('load', function() {
            initTest();
        });
    </script>
</body>
</html> 