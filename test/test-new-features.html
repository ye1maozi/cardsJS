<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            margin: 0;
            padding: 20px;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #2a5298;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        
        .test-section h2 {
            color: #2a5298;
            margin-bottom: 15px;
            border-bottom: 2px solid #2a5298;
            padding-bottom: 5px;
        }
        
        .status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .status-item {
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #2a5298;
        }
        
        .status-item strong {
            color: #2a5298;
        }
        
        button {
            background: #2a5298;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        button:hover {
            background: #1e3c72;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .casting-bar {
            position: relative;
            width: 100%;
            height: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .casting-progress {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
            transition: width 0.1s ease;
            border-radius: 15px;
        }
        
        .casting-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 12px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }
        
        .status-effects {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }
        
        .effect {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .effect.poison {
            background: #8b4513;
        }
        
        .effect.slow {
            background: #4169e1;
        }
        
        .effect.stealth {
            background: #2f4f4f;
        }
        
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>æ–°åŠŸèƒ½æµ‹è¯• - è§’è‰²å±æ€§ç³»ç»Ÿ & åŸå”±ç³»ç»Ÿ</h1>
        
        <div class="test-section">
            <h2>è§’è‰²å±æ€§ç³»ç»Ÿæµ‹è¯•</h2>
            <div class="status">
                <div class="status-item">
                    <strong>ç©å®¶ç”Ÿå‘½:</strong> <span id="playerHealth">30</span>
                </div>
                <div class="status-item">
                    <strong>ç©å®¶èƒ½é‡:</strong> <span id="playerEnergy">1</span>
                </div>
                <div class="status-item">
                    <strong>ç©å®¶å¼ºåº¦:</strong> <span id="playerStrength">0</span>
                </div>
                <div class="status-item">
                    <strong>ç©å®¶æ•æ·:</strong> <span id="playerAgility">0</span>
                </div>
                <div class="status-item">
                    <strong>ç©å®¶ç²¾ç¥:</strong> <span id="playerSpirit">0</span>
                </div>
            </div>
            <button onclick="testCharacterStats()">æµ‹è¯•è§’è‰²å±æ€§</button>
            <button onclick="testHealthRegen()">æµ‹è¯•ç”Ÿå‘½æ¢å¤</button>
            <button onclick="testEnergyRegen()">æµ‹è¯•èƒ½é‡æ¢å¤</button>
        </div>
        
        <div class="test-section">
            <h2>åŸå”±ç³»ç»Ÿæµ‹è¯•</h2>
            <div id="castingBarContainer"></div>
            <button onclick="testCasting()">æµ‹è¯•åŸå”±</button>
            <button onclick="testCastingInterrupt()">æµ‹è¯•åŸå”±ä¸­æ–­</button>
            <button onclick="clearCasting()">æ¸…é™¤åŸå”±</button>
        </div>
        
        <div class="test-section">
            <h2>çŠ¶æ€æ•ˆæœç³»ç»Ÿæµ‹è¯•</h2>
            <div id="statusEffectsContainer" class="status-effects"></div>
            <button onclick="testPoisonEffect()">æµ‹è¯•ä¸­æ¯’æ•ˆæœ</button>
            <button onclick="testSlowEffect()">æµ‹è¯•å‡é€Ÿæ•ˆæœ</button>
            <button onclick="testStealthEffect()">æµ‹è¯•æ½œè¡Œæ•ˆæœ</button>
            <button onclick="clearEffects()">æ¸…é™¤æ‰€æœ‰æ•ˆæœ</button>
        </div>
        
        <div class="test-section">
            <h2>å¡ç‰Œæ•ˆæœæµ‹è¯•</h2>
            <div class="status">
                <div class="status-item">
                    <strong>ç«çƒæœ¯:</strong> 1èƒ½é‡ï¼Œ1ç§’åŸå”±ï¼Œ9ç‚¹ä¼¤å®³
                </div>
                <div class="status-item">
                    <strong>å¥¥æœ¯å†²å‡»:</strong> 0èƒ½é‡ï¼Œ2ç§’åŸå”±ï¼Œæ¶ˆè€—æ‰€æœ‰èƒ½é‡
                </div>
                <div class="status-item">
                    <strong>æ¯’åˆƒ:</strong> 1èƒ½é‡ï¼Œç¬å‘ï¼Œ6ç‚¹ä¼¤å®³+ä¸­æ¯’
                </div>
                <div class="status-item">
                    <strong>ä¼å‡»:</strong> 2èƒ½é‡ï¼Œç¬å‘ï¼Œ15ç‚¹ä¼¤å®³ï¼ˆéœ€æ½œè¡Œï¼‰
                </div>
            </div>
            <button onclick="testFireball()">æµ‹è¯•ç«çƒæœ¯</button>
            <button onclick="testArcaneBlast()">æµ‹è¯•å¥¥æœ¯å†²å‡»</button>
            <button onclick="testPoisonBlade()">æµ‹è¯•æ¯’åˆƒ</button>
            <button onclick="testAmbush()">æµ‹è¯•ä¼å‡»</button>
        </div>
        
        <div class="test-section">
            <h2>æµ‹è¯•æ—¥å¿—</h2>
            <div id="testLog" class="log"></div>
        </div>
    </div>

    <script src="../js/Character.js"></script>
    <script src="../js/CastingSystem.js"></script>
    <script src="../js/Card.js"></script>
    <script>
        let testCharacter = null;
        let testCastingSystem = null;
        let testCard = null;
        let animationId = null;
        
        // åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ
        function initializeTest() {
            testCharacter = new Character("æµ‹è¯•è§’è‰²", "æ³•å¸ˆ");
            testCastingSystem = new CastingSystem();
            testCard = new Card("æµ‹è¯•å¡ç‰Œ", "æ³•å¸ˆ", 1, 1, "åŸå”±", "æµ‹è¯•æ•ˆæœ", "TEST", 10, 0, 0);
            
            addLog("âœ… æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ");
            updateCharacterDisplay();
        }
        
        // æ›´æ–°è§’è‰²æ˜¾ç¤º
        function updateCharacterDisplay() {
            if (!testCharacter) return;
            
            const info = testCharacter.getInfo();
            document.getElementById('playerHealth').textContent = info.health;
            document.getElementById('playerEnergy').textContent = info.energy;
            document.getElementById('playerStrength').textContent = info.strength;
            document.getElementById('playerAgility').textContent = info.agility;
            document.getElementById('playerSpirit').textContent = info.spirit;
        }
        
        // æµ‹è¯•è§’è‰²å±æ€§
        function testCharacterStats() {
            addLog("ğŸ§ª æµ‹è¯•è§’è‰²å±æ€§...");
            addLog(`èŒä¸š: ${testCharacter.characterClass}`);
            addLog(`æœ€å¤§ç”Ÿå‘½: ${testCharacter.maxHealth}`);
            addLog(`æœ€å¤§èƒ½é‡: ${testCharacter.maxEnergy}`);
            addLog(`å¼ºåº¦: ${testCharacter.strength}`);
            addLog(`æ•æ·: ${testCharacter.agility}`);
            addLog(`ç²¾ç¥: ${testCharacter.spirit}`);
        }
        
        // æµ‹è¯•ç”Ÿå‘½æ¢å¤
        function testHealthRegen() {
            addLog("â¤ï¸ æµ‹è¯•ç”Ÿå‘½æ¢å¤...");
            testCharacter.currentHealth = Math.max(1, testCharacter.currentHealth - 10);
            testCharacter.healthRegenRate = 2;
            addLog(`å½“å‰ç”Ÿå‘½: ${testCharacter.currentHealth}`);
            addLog(`ç”Ÿå‘½æ¢å¤é€Ÿåº¦: ${testCharacter.healthRegenRate}/ç§’`);
            
            // å¯åŠ¨æ¢å¤æµ‹è¯•
            startHealthRegenTest();
        }
        
        // å¯åŠ¨ç”Ÿå‘½æ¢å¤æµ‹è¯•
        function startHealthRegenTest() {
            const testInterval = setInterval(() => {
                testCharacter.update(1/60);
                updateCharacterDisplay();
                
                if (testCharacter.currentHealth >= testCharacter.maxHealth) {
                    clearInterval(testInterval);
                    addLog("âœ… ç”Ÿå‘½æ¢å¤æµ‹è¯•å®Œæˆ");
                }
            }, 1000);
        }
        
        // æµ‹è¯•èƒ½é‡æ¢å¤
        function testEnergyRegen() {
            addLog("âš¡ æµ‹è¯•èƒ½é‡æ¢å¤...");
            testCharacter.currentEnergy = 0;
            testCharacter.energyRegenRate = 3;
            addLog(`å½“å‰èƒ½é‡: ${testCharacter.currentEnergy}`);
            addLog(`èƒ½é‡æ¢å¤é€Ÿåº¦: ${testCharacter.energyRegenRate}/ç§’`);
            
            // å¯åŠ¨æ¢å¤æµ‹è¯•
            startEnergyRegenTest();
        }
        
        // å¯åŠ¨èƒ½é‡æ¢å¤æµ‹è¯•
        function startEnergyRegenTest() {
            const testInterval = setInterval(() => {
                testCharacter.update(1/60);
                updateCharacterDisplay();
                
                if (testCharacter.currentEnergy >= testCharacter.maxEnergy) {
                    clearInterval(testInterval);
                    addLog("âœ… èƒ½é‡æ¢å¤æµ‹è¯•å®Œæˆ");
                }
            }, 1000);
        }
        
        // æµ‹è¯•åŸå”±
        function testCasting() {
            addLog("ğŸ”® æµ‹è¯•åŸå”±ç³»ç»Ÿ...");
            
            const target = new Character("ç›®æ ‡", "æˆ˜å£«");
            const success = testCastingSystem.startCasting(testCard, testCharacter, target);
            
            if (success) {
                addLog(`å¼€å§‹åŸå”±: ${testCard.name}`);
                addLog(`åŸå”±æ—¶é—´: ${testCard.castTime}ç§’`);
                
                // å¯åŠ¨åŸå”±åŠ¨ç”»
                startCastingAnimation();
            } else {
                addLog("âŒ åŸå”±å¯åŠ¨å¤±è´¥");
            }
        }
        
        // å¯åŠ¨åŸå”±åŠ¨ç”»
        function startCastingAnimation() {
            const container = document.getElementById('castingBarContainer');
            container.innerHTML = `
                <div class="casting-bar">
                    <div class="casting-progress" style="width: 0%"></div>
                    <div class="casting-text">${testCard.name}</div>
                </div>
            `;
            
            const progressBar = container.querySelector('.casting-progress');
            const textElement = container.querySelector('.casting-text');
            let progress = 0;
            
            const animate = () => {
                progress += 1;
                const percentage = (progress / 60) * 100; // 60å¸§ = 1ç§’
                
                progressBar.style.width = `${percentage}%`;
                textElement.textContent = `${testCard.name} (${(1 - progress/60).toFixed(1)}s)`;
                
                if (progress < 60) {
                    animationId = requestAnimationFrame(animate);
                } else {
                    addLog("âœ… åŸå”±å®Œæˆï¼");
                    container.innerHTML = '';
                }
            };
            
            animate();
        }
        
        // æµ‹è¯•åŸå”±ä¸­æ–­
        function testCastingInterrupt() {
            if (testCastingSystem.isCurrentlyCasting()) {
                testCastingSystem.interruptCasting("æµ‹è¯•ä¸­æ–­");
                addLog("ğŸ›‘ åŸå”±è¢«ä¸­æ–­");
                
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
                
                document.getElementById('castingBarContainer').innerHTML = '';
            } else {
                addLog("âŒ æ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„åŸå”±");
            }
        }
        
        // æ¸…é™¤åŸå”±
        function clearCasting() {
            testCastingSystem.resetCasting();
            document.getElementById('castingBarContainer').innerHTML = '';
            addLog("ğŸ§¹ åŸå”±çŠ¶æ€å·²æ¸…é™¤");
        }
        
        // æµ‹è¯•ä¸­æ¯’æ•ˆæœ
        function testPoisonEffect() {
            addLog("â˜ ï¸ æµ‹è¯•ä¸­æ¯’æ•ˆæœ...");
            const poisonEffect = new PoisonEffect(2, 5);
            testCharacter.addStatusEffect(poisonEffect);
            addLog("ä¸­æ¯’æ•ˆæœå·²æ·»åŠ ï¼ŒæŒç»­5ç§’ï¼Œæ¯ç§’2ç‚¹ä¼¤å®³");
            updateStatusEffectsDisplay();
        }
        
        // æµ‹è¯•å‡é€Ÿæ•ˆæœ
        function testSlowEffect() {
            addLog("ğŸŒ æµ‹è¯•å‡é€Ÿæ•ˆæœ...");
            const slowEffect = new SlowEffect(2, 3);
            testCharacter.addStatusEffect(slowEffect);
            addLog("å‡é€Ÿæ•ˆæœå·²æ·»åŠ ï¼ŒæŒç»­3ç§’ï¼Œæ•æ·-2");
            updateStatusEffectsDisplay();
        }
        
        // æµ‹è¯•æ½œè¡Œæ•ˆæœ
        function testStealthEffect() {
            addLog("ğŸ‘» æµ‹è¯•æ½œè¡Œæ•ˆæœ...");
            const stealthEffect = new StealthEffect(5);
            testCharacter.addStatusEffect(stealthEffect);
            addLog("æ½œè¡Œæ•ˆæœå·²æ·»åŠ ï¼ŒæŒç»­5ç§’");
            updateStatusEffectsDisplay();
        }
        
        // æ¸…é™¤æ‰€æœ‰æ•ˆæœ
        function clearEffects() {
            testCharacter.statusEffects = [];
            document.getElementById('statusEffectsContainer').innerHTML = '';
            addLog("ğŸ§¹ æ‰€æœ‰çŠ¶æ€æ•ˆæœå·²æ¸…é™¤");
        }
        
        // æ›´æ–°çŠ¶æ€æ•ˆæœæ˜¾ç¤º
        function updateStatusEffectsDisplay() {
            const container = document.getElementById('statusEffectsContainer');
            container.innerHTML = '';
            
            testCharacter.statusEffects.forEach(effect => {
                const effectElement = document.createElement('div');
                effectElement.className = `effect ${effect.type}`;
                effectElement.innerHTML = `
                    <span>${effect.description}</span>
                    <span>${effect.duration.toFixed(1)}s</span>
                `;
                container.appendChild(effectElement);
            });
        }
        
        // æµ‹è¯•ç«çƒæœ¯
        function testFireball() {
            addLog("ğŸ”¥ æµ‹è¯•ç«çƒæœ¯...");
            const fireball = new Card("ç«çƒæœ¯", "æ³•å¸ˆ", 1, 1, "åŸå”±", "åŸå”±1ç§’åï¼Œå¯¹å•ä½“ç›®æ ‡é€ æˆ9ç‚¹ä¼¤å®³", "DAMAGE_9", 9, 0, 0);
            addLog(`å¡ç‰Œ: ${fireball.name}`);
            addLog(`èƒ½é‡æ¶ˆè€—: ${fireball.energyCost}`);
            addLog(`åŸå”±æ—¶é—´: ${fireball.castTime}ç§’`);
            addLog(`ä¼¤å®³: ${fireball.value1}`);
        }
        
        // æµ‹è¯•å¥¥æœ¯å†²å‡»
        function testArcaneBlast() {
            addLog("ğŸ’« æµ‹è¯•å¥¥æœ¯å†²å‡»...");
            const arcaneBlast = new Card("å¥¥æœ¯å†²å‡»", "æ³•å¸ˆ", 0, 2, "åŸå”±", "æ¶ˆè€—å½“å‰æ‰€æœ‰èƒ½é‡ï¼Œå¯¹ç›®æ ‡é‡Šæ”¾ä¸€æ¬¡å¼ºåŠ›çš„å¥¥æœ¯å†²å‡»", "CONSUME_ALL_ENERGY", 2, 0, 0);
            addLog(`å¡ç‰Œ: ${arcaneBlast.name}`);
            addLog(`èƒ½é‡æ¶ˆè€—: ${arcaneBlast.energyCost}`);
            addLog(`åŸå”±æ—¶é—´: ${arcaneBlast.castTime}ç§’`);
            addLog(`åŸºç¡€ä¼¤å®³å€æ•°: ${arcaneBlast.value1}`);
        }
        
        // æµ‹è¯•æ¯’åˆƒ
        function testPoisonBlade() {
            addLog("ğŸ—¡ï¸ æµ‹è¯•æ¯’åˆƒ...");
            const poisonBlade = new Card("æ¯’åˆƒ", "ç›—è´¼", 1, 0, "ç¬å‘", "ç«‹åˆ»æ”»å‡»ç›®æ ‡ï¼Œé€ æˆ6ç‚¹ä¼¤å®³ï¼Œå¹¶ä½¿å…¶è·å¾—3å±‚ä¸­æ¯’", "DAMAGE_6_POISON", 6, 3, 0);
            addLog(`å¡ç‰Œ: ${poisonBlade.name}`);
            addLog(`èƒ½é‡æ¶ˆè€—: ${poisonBlade.energyCost}`);
            addLog(`åŸå”±æ—¶é—´: ${poisonBlade.castTime}ç§’`);
            addLog(`ä¼¤å®³: ${poisonBlade.value1}`);
            addLog(`ä¸­æ¯’å±‚æ•°: ${poisonBlade.value2}`);
        }
        
        // æµ‹è¯•ä¼å‡»
        function testAmbush() {
            addLog("âš”ï¸ æµ‹è¯•ä¼å‡»...");
            const ambush = new Card("ä¼å‡»", "ç›—è´¼", 2, 0, "ç¬å‘", "åªèƒ½åœ¨æ½œè¡ŒçŠ¶æ€ä¸‹ä½¿ç”¨ï¼Œç«‹åˆ»æ”»å‡»ï¼Œé€ æˆ15ç‚¹ä¼¤å®³", "DAMAGE_15", 15, 0, 0);
            addLog(`å¡ç‰Œ: ${ambush.name}`);
            addLog(`èƒ½é‡æ¶ˆè€—: ${ambush.energyCost}`);
            addLog(`åŸå”±æ—¶é—´: ${ambush.castTime}ç§’`);
            addLog(`ä¼¤å®³: ${ambush.value1}`);
            addLog(`ç‰¹æ®Šè¦æ±‚: éœ€è¦æ½œè¡ŒçŠ¶æ€`);
        }
        
        // æ·»åŠ æ—¥å¿—
        function addLog(message) {
            const log = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML += `[${timestamp}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog("ğŸš€ æ–°åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½");
            addLog("æµ‹è¯•è¯´æ˜ï¼š");
            addLog("1. è§’è‰²å±æ€§ç³»ç»Ÿ - æµ‹è¯•åŸºç¡€å±æ€§ã€ç”Ÿå‘½æ¢å¤ã€èƒ½é‡æ¢å¤");
            addLog("2. åŸå”±ç³»ç»Ÿ - æµ‹è¯•åŸå”±è¿›åº¦ã€ä¸­æ–­æœºåˆ¶");
            addLog("3. çŠ¶æ€æ•ˆæœç³»ç»Ÿ - æµ‹è¯•ä¸­æ¯’ã€å‡é€Ÿã€æ½œè¡Œæ•ˆæœ");
            addLog("4. å¡ç‰Œæ•ˆæœæµ‹è¯• - éªŒè¯æ–°å¡ç‰Œé…ç½®");
            
            initializeTest();
        });
    </script>
</body>
</html> 